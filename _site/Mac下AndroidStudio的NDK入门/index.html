<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Mac下AndroidStudio的NDK入门 - Kong Jing</title>
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" type="text/css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Merriweather+Sans:400,300,700" type="text/css">
    <link rel="stylesheet" href="/static/app.css" type="text/css">
    <link rel="stylesheet" href="/static/syntax.css" type="text/css">
    <link type="application/atom+xml" rel="alternate" href="http://knjin.com/feed.xml" title="Kong Jing" />
    <meta name="theme-color" content="#111111">

    <meta name="og:type" content="article">
    <meta name="og:title" content="Post: Mac下AndroidStudio的NDK入门">
    <meta name="og:description" content="">
    <meta name="og:site_name" content="Kong Jing">
    <meta name="og:url" content="http://knjin.com/Mac%E4%B8%8BAndroidStudio%E7%9A%84NDK%E5%85%A5%E9%97%A8/">
    
    <meta property="article:published_time" content="2016-11-11">

    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@">
    <meta name="twitter:domain" content="knjin.com">
    <meta name="twitter:title" content="Post: Mac下AndroidStudio的NDK入门">
    <meta name="twitter:description" content="">
    
    <meta name="twitter:url" content="http://knjin.com/Mac%E4%B8%8BAndroidStudio%E7%9A%84NDK%E5%85%A5%E9%97%A8/">
    <script type="text/javascript" src="http://tajs.qq.com/stats?sId=58399545" charset="UTF-8"></script>

  </head>
  <body>
    <header>
      <h1><a href="/">knjin</a></h1>
    </header>

    <div class="content post">
      <h2>Mac下AndroidStudio的NDK入门</h2>
      <p class="date">11 November 2016</p>

      <p>最近开始学习<a href="https://developer.android.com/ndk/index.html">NDK开发</a>，Mac环境下的NDK开发，使用了Androidstudio开发工具进行了一个简单的demo开发。这个博客记录我NDK开发入门。
<!--more--></p>

<p>打开Androidstudio中的SDK-Tools下载工具</p>

<p><img src="http://of77q1ocj.bkt.clouddn.com/NDK_download.png" alt="ndk下载" /></p>

<p>配置好NDK,在terminal中输入</p>

<p><code class="highlighter-rouge">pico .bash_profile</code></p>

<p>然后编辑为</p>

<p><code class="highlighter-rouge">export NDK_ROOT=/Users/Jing/Library/Android/sdk/ndk-bundle</code>
<code class="highlighter-rouge">export PATH=$PATH:$NDK_ROOT</code></p>

<p>然后测试一下是否可以使用</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>ndk-build
</code></pre>
</div>

<p>如果输出</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>Could not find application project directory !
</code></pre>
</div>

<p>那么说明配置成功</p>

<p>新建一个项目，新建类NdkUtil。</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">NdkUtil</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">native</span> <span class="n">String</span> <span class="nf">say</span><span class="o">();</span>

    <span class="kd">static</span> <span class="o">{</span>
        <span class="n">System</span><span class="o">.</span><span class="na">loadLibrary</span><span class="o">(</span><span class="s">"HelloTest"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<p>然后在IDE中Rebuild project，然后可以在app-build-intermediates-classes-debug中发现生成了一个包com.knjin.testndk.NdkUtil.class</p>

<p>现在可以使用terminal查找到该.class的位置</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="gp">$ </span>javah -jni /Users/Jing/Android/TestNdk/app/build/intermediates/classes/debug
</code></pre>
</div>

<p>然后可以看到该目录下生成了C++头文件<code class="highlighter-rouge">com_knjin_testndk_NdkUtil.h</code></p>

<p>或者：</p>

<div class="language-groovy highlighter-rouge"><pre class="highlight"><code><span class="n">terminal</span><span class="err">处于</span>
<span class="n">main</span>
	<span class="o">-</span><span class="n">java</span>
<span class="err">的坐标位置</span>

</code></pre>
</div>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code>javah -d ../jni -jni com.<span class="k">***</span>.testjni.JniTest   //<span class="o">(</span>JniTest是类名<span class="o">)</span>
											//-d ../jni 是头文件生成的文件夹
</code></pre>
</div>

<p>copy 该文件到main下面的jni文件夹中</p>

<div class="language-cpp highlighter-rouge"><pre class="highlight"><code><span class="cm">/* DO NOT EDIT THIS FILE - it is machine generated */</span>
<span class="cp">#include &lt;jni.h&gt;
</span><span class="cm">/* Header for class com_knjin_testndk_NdkUtil */</span>

<span class="cp">#ifndef _Included_com_knjin_testndk_NdkUtil
#define _Included_com_knjin_testndk_NdkUtil
#ifdef __cplusplus
</span><span class="k">extern</span> <span class="s">"C"</span> <span class="p">{</span>
<span class="cp">#endif
</span><span class="cm">/*
 * Class:     com_knjin_testndk_NdkUtil
 * Method:    say
 * Signature: ()Ljava/lang/String;
 */</span>
<span class="n">JNIEXPORT</span> <span class="n">jstring</span> <span class="n">JNICALL</span> <span class="n">Java_com_knjin_testndk_NdkUtil_say</span>
  <span class="p">(</span><span class="n">JNIEnv</span> <span class="o">*</span><span class="p">,</span> <span class="n">jobject</span><span class="p">);</span>

<span class="cp">#ifdef __cplusplus
</span><span class="p">}</span>
<span class="cp">#endif
#endif
</span></code></pre>
</div>

<p>然后再jni中新建一个jnihello.c文件</p>

<div class="language-c highlighter-rouge"><pre class="highlight"><code><span class="cp">#include &lt;jni.h&gt;
</span>
<span class="n">JNIEXPORT</span> <span class="n">jstring</span> <span class="n">JNICALL</span> <span class="n">Java_com_knjin_testndk_NdkUtil_say</span>
        <span class="p">(</span><span class="n">JNIEnv</span> <span class="o">*</span><span class="n">env</span><span class="p">,</span> <span class="n">jobject</span> <span class="n">obj</span><span class="p">){</span>
    <span class="k">return</span> <span class="p">(</span><span class="o">*</span><span class="n">env</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">NewStringUTF</span><span class="p">(</span><span class="n">env</span><span class="p">,</span><span class="s">"这是一个NDK测试程序"</span><span class="p">);</span>
<span class="p">}</span>
</code></pre>
</div>

<p>app的gradle要配置</p>

<div class="language-groovy highlighter-rouge"><pre class="highlight"><code><span class="n">defaultConfig</span> <span class="o">{</span>
    <span class="o">...</span>
    <span class="n">ndk</span><span class="o">{</span>
        <span class="n">moduleName</span> <span class="s2">"HelloTest"</span>
        <span class="n">abiFilters</span> <span class="s2">"armeabi"</span><span class="o">,</span><span class="s2">"armeabi-v7a"</span><span class="o">,</span><span class="s2">"x86"</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<p>在grade.properties中要输入</p>

<div class="language-tex highlighter-rouge"><pre class="highlight"><code>android.useDeprecatedNdk = true
</code></pre>
</div>

<p>现在在/Users/Jing/Android/TestNdk/app/build/intermediates/ndk中会生成一.so包与.mk文件</p>


      <p class="signature">&mdash; knjin</p>
    </div>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-83907137-1', 'http://knjin.com');
      ga('send', 'pageview');
    </script>
  </body>
</html>
